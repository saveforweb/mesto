(()=>{"use strict";var e=document.querySelector(".elements__list"),t=document.querySelector(".profile__edit-button"),n=document.querySelector(".profile__add-button"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__subtitle"),i=document.querySelector(".profile__avatar"),u=document.querySelector(".popup-profile"),a=document.querySelector(".popup-avatar"),c=document.querySelector(".popup__form_type_profile"),l=document.querySelector(".popup__input_type_profile-name"),s=document.querySelector(".popup__input_type_profile-subtitle"),f=document.querySelector(".popup-content"),p=document.querySelector(".popup-approve"),h=document.querySelector(".popup__form_type_content"),d=document.querySelector(".popup__form_type_avatar"),_=document.querySelector(".popup-fullscreen"),y=document.querySelector(".popup__image"),m=document.querySelector(".popup__subtitle"),v=document.querySelector(".profile__avatar-container"),b={formSelector:".popup__form",formFieldsetSelector:".popup__form-items",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inputErrorClass:"popup__input_error"};function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t,n,r,o,i,u,a){var c=t.likes,l=t._id,s=t.name,f=t.link,p=t.owner;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ownerPostId=p._id,this._cardSelector=n,this._itemName=s,this._itemLink=f,this._itemId=l,this._userId=a,this._itemCount=c,this._handleCardClick=r,this._handleAddLike=o,this._handleRemoveLike=i,this._handleLikeButtonClick=this._handleLikeButtonClick.bind(this),this._handleTrashButton=u,this._handleTrashButtonClick=this._handleTrashButtonClick.bind(this)}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"_handleLikeStatus",value:function(e,t){var n=this;e.forEach((function(e){n._userId===e._id&&t.classList.add("element__like-button_cheked")}))}},{key:"_checkUserCard",value:function(e){this._userId!==this._ownerPostId&&e.remove()}},{key:"createCard",value:function(){return this._element=this._getTemplate(),this._elementTrashButton=this._element.querySelector(".element__trash-button"),this._elementImage=this._element.querySelector(".element__image"),this._elementLikeButton=this._element.querySelector(".element__like-button"),this._handleLikeStatus(this._itemCount,this._elementLikeButton),this._checkUserCard(this._elementTrashButton),this._elemetLikeCount=this._element.querySelector(".element__like-count"),this._elemetLikeCount.innerText=this._itemCount.length,this._elementTitle=this._element.querySelector(".element__title"),this._setEventListeners(),this._elementImage.src=this._itemLink,this._elementImage.alt=this._itemName,this._elementTitle.innerText=this._itemName,this._element}},{key:"removeCard",value:function(){this._element.remove(),this._element=null}},{key:"_setEventListeners",value:function(){var e=this;this._elementImage.addEventListener("click",(function(){e._handleCardClick({subtitle:e._itemName,link:e._itemLink})})),this._elementLikeButton.addEventListener("click",this._handleLikeButtonClick),this._elementTrashButton.addEventListener("click",this._handleTrashButtonClick)}},{key:"addLike",value:function(e){this._elemetLikeCount.innerText=e,this._elementLikeButton.classList.add("element__like-button_cheked")}},{key:"removeLike",value:function(e){this._elemetLikeCount.innerText=e,this._elementLikeButton.classList.remove("element__like-button_cheked")}},{key:"_handleLikeButtonClick",value:function(){this._element.querySelector(".element__like-button_cheked")?this._handleRemoveLike(this._itemId,this):this._handleAddLike(this._itemId,this)}},{key:"_handleTrashButtonClick",value:function(){this._handleTrashButton(this)}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t,n){var r=t.render;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._render=r,this._elementContainer=n}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._elementContainer.prepend(e)}},{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._elementContainer.append(t._render(e))}))}}])&&S(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._elementUserName=t,this._elementUserDescription=n,this._elementUserAvatar=r}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._dataUser={name:this._elementUserName.textContent,about:this._elementUserDescription.textContent},this._dataUser}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._elementUserName.textContent=t,this._elementUserDescription.textContent=n,this._elementUserAvatar.src=r}}])&&L(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._elementPopup=t,this._selectorCloseButton=n,this._handleEscClose=this._handleEscClose.bind(this),this._handleOverlayClick=this._handleOverlayClick.bind(this),this._buttonSave=this._elementPopup.querySelector(".popup__button-save")}var t,n;return t=e,(n=[{key:"open",value:function(){this._elementPopup.classList.add("popup_animate"),this._elementPopup.classList.add("popup_open"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._elementPopup.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleOverlayClick",value:function(e){e.target===e.currentTarget&&this.close()}},{key:"renderLoading",value:function(e,t){this._buttonSave.innerText=t}},{key:"setEventListeners",value:function(){this._elementPopup.addEventListener("mousedown",this._handleOverlayClick),this._elementPopup.querySelector(this._selectorCloseButton).addEventListener("mousedown",this._handleOverlayClick)}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(){return I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=T(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},I.apply(this,arguments)}function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=U(e)););return e}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function B(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return R(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(r);if(o){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function u(e,t,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(o=i.call(this,e,t))._elementPopupImageItem=n,o._elementPopupImageSubtitle=r,o.open=o.open.bind(R(o)),o}return t=u,(n=[{key:"open",value:function(e){var t=e.subtitle,n=e.link;this._elementPopupImageItem.src=n,this._elementPopupImageSubtitle.alt=t,this._elementPopupImageSubtitle.innerText=t,I(U(u.prototype),"open",this).call(this)}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(E);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(){return V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=D(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},V.apply(this,arguments)}function D(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=H(e)););return e}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function J(e,t){if(t&&("object"===A(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=H(r);if(o){var n=H(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return J(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=i.call(this,e,t))._handleSubmit=n,r._inputList=Array.from(r._elementPopup.querySelectorAll("input")),r._popupForm=r._elementPopup.querySelector("form"),r}return t=u,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){e[t.name]=t.value})),e}},{key:"resetForm",value:function(){this._popupForm.reset()}},{key:"setEventListeners",value:function(){var e=this;V(H(u.prototype),"setEventListeners",this).call(this),this._popupForm.addEventListener("submit",(function(){e._handleSubmit(e._getInputValues(),e._popupForm.querySelector(".popup__button-save"))}))}}])&&F(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(E);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(){return K="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Q(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},K.apply(this,arguments)}function Q(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}function X(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Y(r);if(o){var n=Y(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return X(this,e)});function u(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=i.call(this,e,t))._approveButton=r._elementPopup.querySelector(".popup__button-save"),r._handleClickButton=n,r}return t=u,(n=[{key:"open",value:function(e,t){var n=this;K(Y(u.prototype),"open",this).call(this),this._approveButton.addEventListener("click",(function(){n._handleClickButton(e,t)}))}}])&&G(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(E);function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(t,n){var r,o,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=function(e){var t=i._form.querySelector(".".concat(e.id,"-error"));e.classList.remove(i._inputErrorClass),t.textContent=""},(r="_hideInputError")in this?Object.defineProperty(this,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[r]=o,this._formSelector=t.formSelector,this._formFieldsetSelector=t.formFieldsetSelector,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inputErrorClass=t.inputErrorClass,this._form=n}var t,n;return t=e,(n=[{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?this._buttonElement.disabled=!0:this._buttonElement.disabled=!1}},{key:"_hasInvalidInput",value:function(){return this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}},{key:"_showInputError",value:function(e){var t=this._form.querySelector(".".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage}},{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"resetForm",value:function(){this._form.reset()}},{key:"_setEventListeners",value:function(){var e=this;this._form.addEventListener("submit",(function(t){t.preventDefault(),e.resetValidation()})),this._fieldsetList=Array.from(this._form.querySelectorAll(this._formFieldsetSelector)),this._fieldsetList.forEach((function(t){e._inputList=Array.from(t.querySelectorAll(e._inputSelector)),e._buttonElement=t.querySelector(e._submitButtonSelector),e._toggleButtonState(),e._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}))}}])&&$(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne="error: none",re=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}},{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"addUserCard",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:e,link:t}),headers:this._headers}).then((function(e){return n._checkResponse(e)}))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((function(t){return e._checkResponse(t)}))}},{key:"updateUserInfo",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:e,about:t}),headers:this._headers}).then((function(e){return n._checkResponse(e)}))}},{key:"updateUserAvatar",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:e}),headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"addCardLike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes "),{method:"PUT",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"removeCardLike",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}},{key:"deleleCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._checkResponse(e)}))}}])&&te(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-48",headers:{authorization:"9f24a9a8-78aa-432d-bb8f-93b592333388","Content-Type":"application/json"}}),oe=[re.getInitialCards(),re.getUserInfo()],ie=new z(u,".popup__button-close",(function(e){ie.renderLoading(!0,"Сохранение..."),re.updateUserInfo(e.name,e.subtitle).then((function(e){he.setUserInfo(e),ie.close()})).catch((function(e){console.log(e)})).finally((function(){ie.renderLoading(!1,"Сохранить")}))})),ue=new z(f,".popup__button-close",(function(e){var t=e.place,n=e.link;ue.renderLoading(!0,"Сохранение..."),re.addUserCard(t,n).then((function(e){de.addItem(ve(e)),fe.resetForm(),ue.close()})).catch((function(e){console.log(e)})).finally((function(){ue.renderLoading(!1,"Создать")}))})),ae=new x(_,".popup__button-close",y,m),ce=new Z(p,".popup__button-close",(function(e,t){ce.renderLoading(!0,"Удаление..."),re.deleleCard(e).then((function(e){t.removeCard(),ce.close()})).catch((function(e){console.log(e)})).finally((function(){ce.renderLoading(!1,"Да")}))})),le=new z(a,".popup__button-close",(function(e){var t=e.avatarlink;le.renderLoading(!0,"Сохранение..."),re.updateUserAvatar(t).then((function(e){he.setUserInfo(e),le.close()})).catch((function(e){console.log(e)})).finally((function(){le.renderLoading(!1,"Сохранить")}))})),se=new ee(b,c),fe=new ee(b,h),pe=new ee(b,d),he=new O(r,o,i),de=new w({render:function(e){return ve(e)}},e);function _e(e){ce.open(this._itemId,e)}function ye(e,t){re.addCardLike(e).then((function(e){t.addLike(e.likes.length)})).catch((function(e){console.log(e)}))}function me(e,t){re.removeCardLike(e).then((function(e){t.removeLike(e.likes.length)})).catch((function(e){console.log(e)}))}function ve(e){return new g(e,".element_template",ae.open,ye,me,_e,ne).createCard()}ce.setEventListeners(),ie.setEventListeners(),ue.setEventListeners(),ae.setEventListeners(),le.setEventListeners(),se.enableValidation(),fe.enableValidation(),pe.enableValidation(),t.addEventListener("click",(function(){var e=he.getUserInfo();l.value=e.name,s.value=e.about,se.resetValidation(),ie.open()})),v.addEventListener("click",(function(){pe.resetForm(),pe.resetValidation(),le.open()})),n.addEventListener("click",(function(){fe.resetForm(),fe.resetValidation(),ue.open()})),Promise.all(oe).then((function(e){ne=e[1]._id,de.renderItems(e[0]),he.setUserInfo(e[1])})).catch((function(e){console.log(e)}))})();